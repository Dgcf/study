<html>
<head>
  <title>warnings</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604043 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="781"/>
<h1>warnings</h1>

<div>
<span><div><div>提示用户某些信息，但是又不需要将其上升为异常级别，那么输出警告信息就会很有用了</div><div>警告消息通常写入 sys.stderr，对警告的处理方式可以灵活的更改</div><div>警告控制分为两个阶段：</div><ul><li><div>首先，警告被触发时，确定是否应该发出消息，警告过滤器可以用来控制是否发出警告消息，警告过滤器是一些<span style="font-weight: bold;">匹配规则</span>和<span style="font-weight: bold;">动作的序列</span>。可以通过调用 filterwarnings() 将规则添加到过滤器，并通过调用 resetwarnings() 将其重置为默认状态。</div></li><li><div>其次，如果要发出消息，则使用用户可设置的钩子来格式化和打印消息</div></li></ul><div><br clear="none"/></div><div><h2>警告过滤器</h2><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">警告过滤器用于控制警告的行为，如忽略，显示或转换为错误（引发异常）。警告过滤器维护着一个有序的过滤规则列表，匹配规则用于确定如何处理警告，<span style="text-decoration: underline;">任何特定警告都将依次与列表中的每个过滤规则匹配，直到找到匹配为止</span>。过滤规则类型为一个元组 (action，message，category，module，lineno)，其中：</div><ul><li><div><span style="font-weight: bold;">action</span> 为以下值：</div></li></ul><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody><tr><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">值</td><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">处理方式</td></tr><tr><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">&quot;error&quot;</td><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">将匹配警告转换为异常</td></tr><tr><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">&quot;ignore&quot;</td><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">忽略匹配的警告——<span style="color: rgb(255, 0, 0);">既然忽略了，要这个有什么作用</span>？</td></tr><tr><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">&quot;always&quot;</td><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">始终输出匹配的警告</td></tr><tr><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">&quot;default&quot;</td><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">对于同样的警告只输出第一次出现的警告</td></tr><tr><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">&quot;module&quot;</td><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">在一个模块中只输出第一次出现的警告</td></tr><tr><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">&quot;once&quot;</td><td rowspan="1" style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);">输出第一次出现的警告,而不考虑它们的位置</td></tr></tbody></table><ul><li><div><span style="font-weight: bold;">message</span> 是包含正则表达式的字符串，警告消息的开始必须匹配，不区分大小写</div></li><li><div><span style="font-weight: bold;">category</span> 是一个警告类型（必须是 Warning 的子类）</div></li><li><div><span style="font-weight: bold;">module</span> 是包含模块名称的正则表达式字符串，区分大小写</div></li><li><div><span style="font-weight: bold;">lineno</span> 是一个整数，警告发生的行号，为 0 则匹配所有行号</div></li></ul><div><h2>默认警告过滤器</h2><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">默认情况下，Python 设置了几个警告过滤器，可以通过 -W 命令行选项和调用 filterwarnings() 函数来覆盖它们。</div><ul><li><div>DeprecationWarning 和 PendingDeprecationWarning 和 ImportWarning 被默认忽略。</div></li><li><div>除非 -b 选项给出一次或两次，否则忽略 BytesWarning；在这种情况下，此警告或者被输出（-b）或者变成异常（-bb）。</div></li><li><div>除非 Python 是在调试模式下构建的，否则将忽略 ResourceWarning。</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">在 3.2 版中的调整: 除 PendingDeprecationWarning 之外，默认情况下将忽略 DeprecationWarning。</div></div><h2>可用函数</h2><h4>warn</h4><div>warnings.warn(message, category=None, stacklevel=1, source=None)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">触发异常。category 参数默认为 UserWarning。message 参数为警告消息，可以是 Warning 实例，在这种情况下，将忽略 category 并使用 message.__class__，消息文本则为 str(message)。</div><h4>warn_explicit</h4><div>warnings.warn_explicit(message, category, filename, lineno, module=None, registry=None, module_globals=None, source=None)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">这是 warn() 函数的低级接口，明确传递消息，类别，文件名和行号，以及可选的模块名称和注册表（应该是模块的 __warningregistry__ 字典）</div><h4>showwarning</h4><div>warnings.showwarning(message, category, filename, lineno, file=None, line=None)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">写入警告到文件。默认调用 formatwarning(message, category, filename, lineno, line) 并将结果字符串写入 file，默认为 sys.stderr。 line 是包含在警告消息中的一行源代码；如果未提供则尝试读取由 filename 和 lineno 指定的行。</div><h4>formatwarning</h4><div>warnings.formatwarning(message, category, filename, lineno, line=None)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">格式化警告，返回一个字符串。可能包含嵌入的换行符，并以换行符结束。 line 是包含在警告消息中的一行源代码；如果不提供则尝试读取由 filename 和 lineno 指定的行。</div><h4>filterwarnings</h4><div>warnings.filterwarnings(action, message='', category=Warning, module='', lineno=0, append=False)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">过滤警告，在 警告过滤器规则 列表中插入一个条目。默认情况下，条目插入在前面；如果 append 为真，则在末尾插入。它检查参数的类型，编译 message 和 module 的正则表达式，并将它们作为警告过滤器列表中的元组插入。如果多个地方都匹配特定的警告，那么更靠近列表前面的条目会覆盖列表中后面的条目，省略的参数默认为匹配一切的值。</div><h4>simplefilter</h4><div>warnings.simplefilter(action, category=Warning, lineno=0, append=False)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">简单易用的过滤器，类似 filterwarnings() 函数，但是不需要正则表达式。</div><h4>resetwarnings</h4><div>warnings.resetwarnings()</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">重置警告过滤器。这会丢弃所有以前对 filterwarnings() 调用的影响，包括 -W 命令行选项和对 simplefilter() 的调用的影响。</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;"><br clear="none"/></div><h2>可用的上下文管理器</h2><div>class warnings.catch_warnings(*, record=False, module=None)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">捕获警告，在退出上下文时恢复警告过滤器和 showwarning() 函数功能。如果 record 参数是 False （缺省值），则上下文管理器在入口处返回 None。如果 record 是 True，则返回一个列表，该列表元素为 showwarning() 函数所见的对象，列表中的每个元素都具有与 showwarning() 的参数具有相同名称的属性。</div><div>import warnings</div><div><br/></div><div>warnings.simplefilter(&quot;always&quot;)</div><div><br/></div><div>def fxn():</div><div><span>    </span>warnings.warn(&quot;this is a warning&quot;, Warning)</div><div><br/></div><div>with warnings.catch_warnings():</div><div>warnings.simplefilter(&quot;ignore&quot;)</div><div>fxn()</div><div><br/></div><div>with warnings.catch_warnings(Warning):</div><div>warnings.warn(&quot;this is a warning2&quot;, Warning)</div><div><br/></div><div>warnings.warn(&quot;this is a warning3&quot;, Warning)</div><div><br/></div><div>def fxn2():</div><div>warnings.warn(&quot;deprecated&quot;, DeprecationWarning)</div><div><br/></div><div>with warnings.catch_warnings(record=True) as w:</div><div># Cause all warnings to always be triggered.</div><div>warnings.simplefilter(&quot;always&quot;)</div><div># Trigger a warning.</div><div>fxn2()</div><div># Verify some things</div><div>assert len(w) == 1</div><div>assert issubclass(w[-1].category, DeprecationWarning)</div><div>assert &quot;deprecated&quot; in str(w[-1].message)</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">可以从命令行通过传递 -Wd 参数到解释器（即为 -W default 的速记）。这将为所有警告启用默认处理，包括默认情况下忽略的警告。要更改遇到的警告所采取的操作，只需更改传递给 -W 的参数即可，如 -W error。可以用 python --help 来查看 -W 参数的详细使用。</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">在代码中实现 -Wd 的功能为:</div><div>warnings.simplefilter('default')</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;">这样的代码应该在程序开始被执行，否则有些警告可能仍然会被触发。</div><div style="margin-top: 1em; margin-bottom: 1em;-en-paragraph:true;"><br clear="none"/></div></div><div><br/></div></div></span>
</div></body></html> 