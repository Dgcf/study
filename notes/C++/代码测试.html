<html>
<head>
  <title>代码测试</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604043 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="717"/>
<h1>代码测试</h1>

<div>
<span><div><h2><span style="font-size: 14px;"><span style="font-size: 14px; font-weight: bold;">官方文档</span>：<a href="https://github.com/google/googletest/blob/master/googletest/docs/primer.md" shape="rect" style="font-size: 14px;" target="_blank">https://github.com/google/googletest/blob/master/googletest/docs/primer.md</a></span></h2><div>中译：<a href="https://blog.csdn.net/qq_16309049/article/details/79570241" shape="rect" target="_blank">https://blog.csdn.net/qq_16309049/article/details/79570241</a></div><div><br clear="none"/></div><div>参考博客：<a href="https://www.cnblogs.com/aoyihuashao/p/9203479.html" shape="rect">https://www.cnblogs.com/aoyihuashao/p/9203479.html</a></div><h2><br clear="none"/></h2><div><br/></div><div>断言：</div><ul><li><div>ASSERT_*系列的断言，当执行失败时结束当前函数；EXPECT_*产生非致命错误，不会结束当前执行的函数</div></li><li><div>支持&lt;&lt;运算符，类似于ostream，用于自定义输出内容</div></li><li><div>基本断言：</div></li></ul><div><img src="代码测试_files/Image.png" type="image/png" data-filename="Image.png"/></div><ul><li><div>比较</div></li><ul><li><div>必须支持比较运算符，如果是自定义类型就要重载</div></li><li><div>使用*_EQ(ptr, nullptr) 和*_NE(ptr, nullptr) 代替 *_EQ(ptr, NULL) and *_NE(ptr, NULL)，因为nullptr是类型</div></li></ul></ul><div><img src="代码测试_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>C风格字符串的比较</div></li></ul><div><img src="代码测试_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>main函数：</div></li><ul><li><div>用户不需要写main，如果要自己写需要返回值：RUN_ALL_TESTS()</div></li><li><div>gtest自己的入口点：gtest_main</div></li></ul></ul><div><br/></div><div><br/></div><h2>转自：https://www.jianshu.com/p/65eb22508441</h2><h2>下载 Google Test</h2><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">从 GitHub 上使用 git 来下载 googletest 的源码：</div><div>git clone https://github.com/google/googletest.git</div><h2>编译 Google Test</h2><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">我参考了 googletest 提供的编译文档，这里使用简单的 cmake 来编译。</div><h3>安装 cmake</h3><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-weight: bold;">如果已经安装了</span> <span style="font-weight: bold;">cmake</span><span style="font-weight: bold;">，则可以跳过这个步骤</span>，如何查看是否安装过？在命令行键入下面的命令：</div><div>cmake --version</div><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">出现相关的版本信息，则表示你已经安装过了：</div><div>cmake version 3.5.2</div><div><br/></div><div>CMake suite maintained and supported by Kitware (kitware.com/cmake).</div><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">如果你没有安装，则可以按照下面的步骤来安装：</div><div># Add cmake PPA</div><div>sudo apt-get install software-properties-common</div><div>sudo add-apt-repository ppa:george-edison55/cmake-3.x</div><div>sudo apt-get update</div><div><br/></div><div># install cmake</div><div>sudo apt-get install cmake</div><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">安装完成，进入下一步。</div><h3>新建 mybuild 目录</h3><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">文档要求我们新建一个目录来作为 cmake 的执行目录：</div><div>mkdir mybuild</div><h3>生成 cmake 项目</h3><div>cd mybuild</div><div><br/></div><div># 注意：${GTEST_DIR} 是你的 googletest 的路径</div><div># 例如我的路径是：/home/orange/Documents/googletest/</div><div>cmake ${GTEST_DIR}</div><h3>make</h3><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">运行完上面的 cmake ${GTEST_DIR} 指令后，在 mybuild 目录下你会看到生成的 Makefile 文件，我们直接 make 即可编译 googletest：</div><div>make</div><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">make 的过程不长，并且会出现<span style="font-weight: bold;">绿色的编译提示信息</span>：</div><div>[ 9%] Building CXX object googlemock/CMakeFiles/gmock.dir/__/googletest/src/gtest-all.cc.o</div><div>[ 18%] Building CXX object googlemock/CMakeFiles/gmock.dir/src/gmock-all.cc.o</div><div>[ 27%] Linking CXX static library libgmock.a</div><div>[ 27%] Built target gmock</div><div>[ 36%] Building CXX object googlemock/CMakeFiles/gmock_main.dir/__/googletest/src/gtest-all.cc.o</div><div>[ 45%] Building CXX object googlemock/CMakeFiles/gmock_main.dir/src/gmock-all.cc.o</div><div>[ 54%] Building CXX object googlemock/CMakeFiles/gmock_main.dir/src/gmock_main.cc.o</div><div>[ 63%] Linking CXX static library libgmock_main.a</div><div>[ 63%] Built target gmock_main</div><div>[ 72%] Building CXX object googlemock/gtest/CMakeFiles/gtest.dir/src/gtest-all.cc.o</div><div>[ 81%] Linking CXX static library libgtest.a</div><div>[ 81%] Built target gtest</div><div>[ 90%] Building CXX object googlemock/gtest/CMakeFiles/gtest_main.dir/src/gtest_main.cc.o</div><div>[100%] Linking CXX static library libgtest_main.a</div><div>[100%] Built target gtest_main</div><h3>sudo make install</h3><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">在 make 完成后，需要将生成的文件安装到系统中，需要使用 root 来安装：</div><div>sudo make install</div><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">你将会看到下面一些提示信息：</div><div>[ 27%] Built target gmock</div><div>[ 63%] Built target gmock_main</div><div>[ 81%] Built target gtest</div><div>[100%] Built target gtest_main</div><div>Install the project...</div><div>-- Install configuration: &quot;&quot;</div><div>-- Installing: /usr/local/lib/libgmock.a</div><div>-- Installing: /usr/local/lib/libgmock_main.a</div><div>...省略</div><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">它们的意思是将 googletest 相关的<span style="font-weight: bold;">头文件</span>拷贝到 /usr/local/include/gtest 目录下，将相关的<span style="font-weight: bold;">库文件</span>拷贝到 /usr/local/lib 下，在 Linux 下<span style="font-weight: bold;">安装程序的过程其实就拷贝文件的过程</span>。</div><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">安装完成之后，我们必须要来测试安装是否成功，顺便学习基本的用法。</div><h2>测试 Google Test</h2><h3>hello_test.cpp</h3><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">下面我们编写一个 Hello Google Test 来测试 googletest 是否安装成功：</div></div><div><h3>hello_test.cpp</h3><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">下面我们编写一个 Hello Google Test 来测试 googletest 是否安装成功：</div><div>// hello_test.cpp</div><div><br/></div><div>// 必须包含 googletest 的头文件</div><div>#include &lt;gtest/gtest.h&gt;</div><div>#include &lt;iostream&gt;</div><div><br/></div><div>// 待测函数</div><div>int fun(int a) {</div><div>return a + 1;</div><div>}</div><div><br/></div><div>// 单元测试</div><div>TEST(FunTest, HandlesZeroInput) {</div><div>EXPECT_EQ(1, fun(0));</div><div>}</div><div><br/></div><div>int main(int argc, char **argv) {</div><div>// 规定的 2 行代码</div><div>::testing::InitGoogleTest(&amp;argc, argv);</div><div>return RUN_ALL_TESTS();</div><div>}</div><h3>编译</h3><div style="margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;">编译需要链接 libgtest.a 和 libpthread.so 这两个库：</div><div>g++ hello_test.cpp /usr/local/lib/libgtest.a -lpthread -o hello_test</div></div><div><br clear="none"/></div></span>
</div></body></html> 